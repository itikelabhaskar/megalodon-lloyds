{
  "cache_metadata": {
    "last_updated": "2025-12-11T07:09:09.972328",
    "version": "1.0.0"
  },
  "tables": {
    "policies_week1": {
      "rules": [
        {
          "rule_id": "DQ_COMPLETENESS_001",
          "name": "cus_death_date_null_rate_check",
          "description": "Check for null values in CUS_DEATH_DATE.  High null rate detected by Dataplex.",
          "natural_language": "The customer death date should be populated when the customer's life status is deceased.  This rule checks for missing death dates.",
          "sql": "SELECT * FROM `PROJECT.DATASET.TABLE_NAME` WHERE CUS_LIFE_STATUS = 'DCD' AND CUS_DEATH_DATE IS NULL",
          "severity": "high",
          "category": "Completeness",
          "dq_dimension": "Completeness",
          "scope": "single_table",
          "source": "dataplex",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_COMPLETENESS_002",
          "name": "scm_sch_leave_date_null_rate_check",
          "description": "Check for null values in SCM_SCH_LEAVE_DATE. High null rate detected by Dataplex.",
          "natural_language": "The scheme leave date should be populated when a member leaves the scheme. This rule checks for missing leave dates.",
          "sql": "SELECT * FROM `PROJECT.DATASET.TABLE_NAME` WHERE SCM_MEMBER_STATUS = 'LEFT' AND SCM_SCH_LEAVE_DATE IS NULL",
          "severity": "medium",
          "category": "Completeness",
          "dq_dimension": "Completeness",
          "scope": "single_table",
          "source": "dataplex",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_ACCURACY_001",
          "name": "cus_dob_future_check",
          "description": "Check if customer date of birth is in the future.  Addresses pre-existing rule COL_001.",
          "natural_language": "A customer's date of birth cannot be in the future. This rule identifies invalid birth dates.",
          "sql": "SELECT * FROM `PROJECT.DATASET.TABLE_NAME` WHERE CUS_DOB > CURRENT_DATE()",
          "severity": "critical",
          "category": "Accuracy",
          "dq_dimension": "Accuracy",
          "scope": "single_table",
          "source": "preexisting",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_ACCURACY_002",
          "name": "poli_gross_pmt_negative_check",
          "description": "Check if policy gross payment is negative. Addresses pre-existing rule COL_002.",
          "natural_language": "The gross payment for a policy cannot be negative. This rule identifies invalid payment amounts.",
          "sql": "SELECT * FROM `PROJECT.DATASET.TABLE_NAME` WHERE POLI_GROSS_PMT < 0",
          "severity": "high",
          "category": "Validity",
          "dq_dimension": "Accuracy",
          "scope": "single_table",
          "source": "preexisting",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_CONFORMITY_001",
          "name": "cus_ni_no_format_check",
          "description": "Check if NI number follows the UK format. Addresses pre-existing rule ATA_003.",
          "natural_language": "The National Insurance number must follow the correct UK format (2 letters, 6 digits, 1 letter). This rule validates the format.",
          "sql": "SELECT * FROM `PROJECT.DATASET.TABLE_NAME` WHERE CUS_NI_NO IS NOT NULL AND NOT REGEXP_CONTAINS(CUS_NI_NO, r'^[A-Z]{2}[0-9]{6}[A-D]$')",
          "severity": "medium",
          "category": "Format",
          "dq_dimension": "Conformity",
          "scope": "single_table",
          "source": "preexisting",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_TEMPORAL_001",
          "name": "deceased_status_reversal_check",
          "description": "Check if a customer marked as deceased in an earlier week becomes alive in a later week.",
          "natural_language": "Customers who were deceased should not become alive in later weeks - this indicates a data quality issue.",
          "sql": "SELECT w2.CUS_ID, w1.CUS_LIFE_STATUS as week1_status, w2.CUS_LIFE_STATUS as week2_status FROM `PROJECT.DATASET.policies_week1` w1 JOIN `PROJECT.DATASET.policies_week2` w2 ON w1.CUS_ID = w2.CUS_ID WHERE w1.CUS_LIFE_STATUS = 'DCD' AND w2.CUS_LIFE_STATUS <> 'DCD'",
          "severity": "critical",
          "category": "Timeliness",
          "dq_dimension": "Timeliness",
          "scope": "cross_week",
          "source": "agent",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_TEMPORAL_002",
          "name": "death_date_consistency_check",
          "description": "Check if a customer's death date changes between weeks.",
          "natural_language": "A customer's death date should not change between weeks. This rule identifies inconsistencies in death dates.",
          "sql": "SELECT w2.CUS_ID, w1.CUS_DEATH_DATE as week1_death_date, w2.CUS_DEATH_DATE as week2_death_date FROM `PROJECT.DATASET.policies_week1` w1 JOIN `PROJECT.DATASET.policies_week2` w2 ON w1.CUS_ID = w2.CUS_ID WHERE w1.CUS_DEATH_DATE IS NOT NULL AND w2.CUS_DEATH_DATE IS NOT NULL AND w1.CUS_DEATH_DATE <> w2.CUS_DEATH_DATE",
          "severity": "high",
          "category": "Timeliness",
          "dq_dimension": "Timeliness",
          "scope": "cross_week",
          "source": "agent",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_TEMPORAL_003",
          "name": "premium_fluctuation_check",
          "description": "Check for significant fluctuations in policy gross payment between weeks.",
          "natural_language": "The gross payment for a policy should not fluctuate significantly between weeks. This rule identifies unusual changes in payment amounts.",
          "sql": "SELECT w2.CUS_ID, w1.POLI_GROSS_PMT as week1_premium, w2.POLI_GROSS_PMT as week2_premium FROM `PROJECT.DATASET.policies_week1` w1 JOIN `PROJECT.DATASET.policies_week2` w2 ON w1.CUS_ID = w2.CUS_ID WHERE ABS(w2.POLI_GROSS_PMT - w1.POLI_GROSS_PMT) > (0.2 * w1.POLI_GROSS_PMT)",
          "severity": "medium",
          "category": "Timeliness",
          "dq_dimension": "Timeliness",
          "scope": "cross_week",
          "source": "agent",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_UNIQUENESS_001",
          "name": "duplicate_customer_id_check",
          "description": "Check for duplicate customer IDs within the table.",
          "natural_language": "Each customer ID should be unique within the table. This rule identifies duplicate customer records.",
          "sql": "SELECT CUS_ID, COUNT(*) FROM `PROJECT.DATASET.TABLE_NAME` GROUP BY CUS_ID HAVING COUNT(*) > 1",
          "severity": "high",
          "category": "Uniqueness",
          "dq_dimension": "Uniqueness",
          "scope": "single_table",
          "source": "agent",
          "table": "policies_week1"
        },
        {
          "rule_id": "DQ_CONFORMITY_002",
          "name": "life_status_code_validation",
          "description": "Check if the life status code is one of the allowed values.",
          "natural_language": "The customer life status code must be one of the allowed values (e.g., 'ALV', 'DCD'). This rule validates the life status code.",
          "sql": "SELECT * FROM `PROJECT.DATASET.TABLE_NAME` WHERE CUS_LIFE_STATUS NOT IN ('ALV', 'DCD', 'Other Valid Codes')",
          "severity": "medium",
          "category": "Conformity",
          "dq_dimension": "Conformity",
          "scope": "single_table",
          "source": "agent",
          "table": "policies_week1"
        }
      ],
      "generated_at": "2025-12-11T07:09:09.972328",
      "rule_count": 10
    }
  }
}